**Общие замечания**

* Если нужно задействовать все дорожки, нужно явно указать *-map 0* (например, если нужно вырезать фрагмент видео, оставив оригинальную структуру). Иначе возьмется по одной дорожке каждого типа. 

* Если нужно сохранить оригинальные параметры кодеков дорожек, обязательно надо указывать это явно:

  *-c:v copy -c:s copy -c:a copy* (s - субтитры)

* Иногда `-acodec` и `-c:a` ведут себя по-разному (одно может не работать)

* Обычно если нужны не все дорожки и используется -map 0:n, то для желаемых нужно явно задавать потом все опции, например, `-b:a:4 640k`

* Запуск без параметров выводит информацию о файле:

  *ffmpeg -i src.mkv*
  
* Опция `-y` дает перезапись файла с тем же именем



## Два комплексных примера

* Полноценный рип фильма с перекодированием видео в другой битрейт, и аудио тоже, а одно аудио оставить как есть, выбросить лишние дорожки:

  ```
  ffmpeg -y -i src.mkv -map 0:0 -map 0:2 -map 0:8 -c:v libx264 -b:v 29180k -c:a:0 copy -acodec:1 ac3 -b:a:1 640k out.mkv
  ```

  В начале через -map указываются желаемые дорожки. 

  -map 0:0 это всегда видеодорожка, а -map 0:2 и -map 0:8 это аудиодорожки, причем номера 2 и 8 это номера в *исходном* файле, а в целевом файле у них будут номера 0 и 1 (среди аудиодорожек, а "голый" 0 это всегда видео). Поэтому указывая `-c:a:0 copy` и `-acodec:1 ac3` с `-b:a:1 640k`, мы фактически говорим "для аудиодорожки 2 *исходного* файла кодек не менять, а для аудиодорожки 8 использовать кодек ac3 с битрейтом 640kbit".

  Причем использование именно такого вида `-acodec:1`, а не `-c:a:1` оказалось почему-то принципиальным, иначе tsMuxer не видел эту аудиодорожку.

* Взять видео и аудио из разных файлов, с аудио перекодированием и без перекодирования:

  ```
  ffmpeg -y -i hackers_rip_28mbit_failed_sound.mkv -i Hackers.1995.REMASTERED.1080p.mkv -map 0:0 -map 1:2 -map 1:8 -c:v copy -acodec:0 copy -acodec:1 ac3 -b:a:1 640k hack.mkv
  ```

  Здесь указаны два исходных файла, а обращение к ним через первую цифру -map **0**:0 и -map **1**:2

* Объединить два файла с перекодировкой

  ```
  ffmpeg -i 00014.m2ts -i 00015.m2ts -filter_complex "[0:0] [0:3] [1:0] [1:3] concat=n=2:v=1:a=1 [v] [a1]" -map "[v]" -c:v libx264 -b:v 19500k -map "[a1]" -c:a ac3 -b:a 640k moskva_19500.mkv
  ```

  Указываем последовательно дорожки для объединения в корректном порядке. В concat n=количество объединяемых элементов. У нас 1 видео и 1 аудио, итого 2, поэтому n=2. Остальное очевидно.



**Перекодировать аудио, а видео не трогать**

*ffmpeg -i src.mkv -map 0 **-c:a ac3 -b:a 640k** -c:v copy -c:s copy result.mkv*

Все дорожки останутся на своих местах за счет параметра -map 0, для кодирования использовать кодек ac3 с битрейтом 640kbit

**Выкинуть лишние дорожки**

*ffmpeg -i src.mkv -c:v copy -c:a copy -map 0:0 -map0:3 -map 0:5 result.mkv*

Здесь перечисляются дорожки, которые нужно *оставить*

**Вырезать фрагмент заданной длины**

*ffmpeg **-ss 00:50:10** -i "some src.mkv" **-map 0** -c:v copy -c:s copy -c:a copy **-t 00:00:40** result.mkv*

Вырезать 40 секунд, начиная с 50 минуты 10 секунды, оставив параметры дорожек исходными и оставив все дорожки на своих местах. Если не указать -t, тогда вырежется до конца файла.

**Картинки из видео каждые N секунд**

*ffmpeg -i dnd.mkv -vf fps=1/5 img%05d.jpg*

**Увеличить громкость**

*-af "volume=15dB"*

*-filter:a "volume=2.0"*

**Извлечь субтитры**

*ffmpeg -i src.mkv -map 0:8 subs.srt* 

**Разные опции для разных дорожек одновременно**

Например, если есть несколько дорожек и нужно вытащить одну как есть, а вторую перекодировать

`ffmpeg -i "source.mkv" -c:a:3 copy -c:a:4 ac3 -b:a 640k -map 0:3 "dir\rus.ac3" -map 0:4 "dir\eng.ac3"`

**Вытащить аудиотрек в mp3**

*ffmpeg -i src.mkv -c:a mp3 -b:a 320k -map 0:1 snd.mp3*

*ffmpeg -i src.mp4 -c:a mp3 -b:a 192k -map 0:1 mix.mp3 -map 0:2 gam.mp3 -map 0:3 mic.mp3*

**Заменить аудиодорожку в видео**

*ffmpeg.exe -i vid.avi -i snd.ac3 -map 0:v -map 1:a -c copy res.avi*

Видео и аудио должны быть одной длины

**Нарезать файл поминутно**

*FOR /L %p IN (0,1,5) DO ffmpeg -y -ss %p:00 -i snd.ac3 -c copy -t 1:00 %p.ac3*

*-y* перезаписать файл

**Нарезать по 10 минут файл больше часа**

*FOR /L %h IN (0,1,1) DO FOR /L %m IN (0,10,50) DO ffmpeg.exe -y -ss %h:%m:00 -i snd.mp3 -c copy -t 10:00 0%h.%m.mp3*

**Объединить файл**

Создать файл со списком
file '/path/to/file1'
file '/path/to/file2'
file '/path/to/file3'

*ffmpeg -safe 0 -f concat -i list.txt -c copy output.mp4*



